<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>node.js TypeError: path must be absolute or specify root to res.sendFile [failed to parse JSON] | RiffVibe</title><meta name=generator content="Hugo 0.98.0"><meta name=description content="[add] So my next problem is that when i try adding a new dependence (npm install --save socket.io). The JSON file is also valid. I get this error: Failed to parse json
npm ERR! Unexpected string npm ERR! File: /Users/John/package.json npm ERR! Failed to parse package.json data. npm ERR! package.json must be actual JSON, not just JavaScript. npm ERR! npm ERR! This is not a bug in npm. npm ERR! Tell the package author to fix their package."><link rel=stylesheet href=https://assets.cdnweb.info/hugo/cayman/css/normalize.css><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700" rel=stylesheet type=text/css><link rel=stylesheet href=https://assets.cdnweb.info/hugo/cayman/css/cayman.css><link rel=apple-touch-icon sizes=180x180 href=./apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=./favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=./favicon-16x16.png><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css integrity=sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.js integrity=sha384-9Nhn55MVVN0/4OFx7EE5kpFBPsEMZxKTCnA+4fqDmg12eCTqGi6+BB2LjY8brQxJ crossorigin=anonymous></script>
<script defer src=https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/contrib/auto-render.min.js integrity=sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI crossorigin=anonymous onload=renderMathInElement(document.body)></script></head><body><section class=page-header><h1 class=project-name>RiffVibe</h1><h2 class=project-tagline></h2><nav><a href=./index.html class=btn>Blog</a>
<a href=./sitemap.xml class=btn>Sitemap</a>
<a href=./index.xml class=btn>RSS</a></nav></section><section class=main-content><h1>node.js TypeError: path must be absolute or specify root to res.sendFile [failed to parse JSON]</h1><div><strong>Publish date: </strong>2024-08-02</div><img src=https://cdn.statically.io/img/cdn.sstatic.net/Sites/stackoverflow/Img/apple-touch-icon@2.png style=margin:auto;display:block;text-align:center;max-width:100%;height:auto><p>[add] So my next problem is that when i try adding a new dependence (npm install --save socket.io). The JSON file is also valid. I get this error: Failed to parse json</p><pre><code>npm ERR! Unexpected string npm ERR! File: /Users/John/package.json npm ERR! Failed to parse package.json data. npm ERR! package.json must be actual JSON, not just JavaScript. npm ERR! npm ERR! This is not a bug in npm. npm ERR! Tell the package author to fix their package.json file. JSON.parse </code></pre><p>So I've been trying to figure out why this error has been returning. All of the files (HTML,JSON,JS) are inside the same folder on my desktop. I'm using node.js and socket.io</p><p>This is my JS file:</p><pre><code>var app = require('express')(); var http = require('http').Server(app); app.get('/', function(req, res){ res.sendFile('index.html'); }); http.listen(3000,function(){ console.log('listening on : 3000'); }); </code></pre><p>This is what is getting returned:</p><pre><code>MacBook-Pro:~ John$ node /Users/John/Desktop/Chatapp/index.js listening on : 3000 TypeError: path must be absolute or specify root to res.sendFile at ServerResponse.sendFile (/Users/John/node_modules/express/lib/response.js:389:11) at /Users/John/Desktop/Chatapp/index.js:5:7 at Layer.handle [as handle_request] (/Users/John/node_modules/express/lib/router/layer.js:76:5) at next (/Users/John/node_modules/express/lib/router/route.js:100:13) at Route.dispatch (/Users/John/node_modules/express/lib/router/route.js:81:3) at Layer.handle [as handle_request] (/Users/John/node_modules/express/lib/router/layer.js:76:5) at /Users/John/node_modules/express/lib/router/index.js:234:24 at Function.proto.process_params (/Users/John/node_modules/express/lib/router/index.js:312:12) at /Users/John/node_modules/express/lib/router/index.js:228:12 at Function.match_layer (/Users/John/node_modules/express/lib/router/index.js:295:3) TypeError: path must be absolute or specify root to res.sendFile at ServerResponse.sendFile (/Users/John/node_modules/express/lib/response.js:389:11) at /Users/John/Desktop/Chatapp/index.js:5:7 at Layer.handle [as handle_request] (/Users/John/node_modules/express/lib/router/layer.js:76:5) at next (/Users/John/node_modules/express/lib/router/route.js:100:13) at Route.dispatch (/Users/John/node_modules/express/lib/router/route.js:81:3) at Layer.handle [as handle_request] (/Users/John/node_modules/express/lib/router/layer.js:76:5) at /Users/John/node_modules/express/lib/router/index.js:234:24 at Function.proto.process_params (/Users/John/node_modules/express/lib/router/index.js:312:12) at /Users/John/node_modules/express/lib/router/index.js:228:12 at Function.match_layer (/Users/John/node_modules/express/lib/router/index.js:295:3) </code></pre><span class=d-none itemprop=commentCount>1</span><h2 class=mb0 data-answercount=17>17 Answers</h2><p>The error is pretty clear, you need to specify an absolute (instead of relative) path and/or set <code>root</code> in the config object for <code>res.sendFile()</code>. Examples:</p><pre><code>// assuming index.html is in the same directory as this script res.sendFile(__dirname + '/index.html'); </code></pre><p>or specify a root (which is used as the base path for the first argument to <code>res.sendFile()</code>:</p><pre><code>res.sendFile('index.html', { root: __dirname }); </code></pre><p>Specifying the <code>root</code> path is more useful when you're passing a user-generated file path which could potentially contain malformed/malicious parts like <code>..</code> (e.g. <code>../../../../../../etc/passwd</code>). Setting the <code>root</code> path prevents such malicious paths from being used to access files outside of that base path.</p><span class=d-none itemprop=commentCount>5</span><p>in .mjs files we for now don't have __dirname</p><p>hence</p><pre><code>res.sendFile('index.html', { root: '.' }) </code></pre><span class=d-none itemprop=commentCount>3</span><p>Try adding root path.</p><pre><code>app.get('/', function(req, res) { res.sendFile('index.html', { root: __dirname }); }); </code></pre><span class=d-none itemprop=commentCount>0</span><p>I used the code below and tried to show the sitemap.xml file</p><pre><code>router.get('/sitemap.xml', function (req, res) { res.sendFile('sitemap.xml', { root: '.' }); }); </code></pre><span class=d-none itemprop=commentCount>1</span><p>If you trust the path, path.resolve is an option:</p><pre><code>var path = require('path'); // All other routes should redirect to the index.html app.route('/*') .get(function(req, res) { res.sendFile(path.resolve(app.get('appPath') + '/index.html')); }); </code></pre><span class=d-none itemprop=commentCount></span><p>The error is pretty straightforward. Most likely the reason is that your index.html file is not in the root directory.</p><p>Or if it is in the root directory then the relative referencing is not working.</p><p>So you need to tell the server exact location of your file. This could be done by using dirname method in NodeJs. Just replace your code with this one:</p><pre><code> app.get('/', function(req, res){ res.sendFile(__dirname + '/index.html'); }); </code></pre><p>Make sure that your add the slash "/" symbol before your homepage. Otherwise your path will become: rootDirectoryindex.html</p><p>Whereas you want it to be: rootDirectory/index.html</p><span class=d-none itemprop=commentCount></span><p>If you are working on Root Directory then you can use this approach</p><pre><code>res.sendFile(__dirname + '/FOLDER_IN_ROOT_DIRECTORY/index.html'); </code></pre><p>but if you are using Routes which is inside a folder lets say <code>/Routes/someRoute.js</code> then you will need to do something like this</p><pre><code>const path = require("path"); ... route.get("/some_route", (req, res) =&gt; { res.sendFile(path.resolve('FOLDER_IN_ROOT_DIRECTORY/index.html') }); </code></pre><span class=d-none itemprop=commentCount></span><p>In Typescript with relative path to the icon:</p><pre><code>import path from 'path'; route.get('/favicon.ico', (_req, res) =&gt; res.sendFile(path.join(__dirname, '../static/myicon.png'))); </code></pre><span class=d-none itemprop=commentCount></span><p>It will redirects to index.html on localhost:8080 call.</p><pre><code>app.get('/',function(req,res){ res.sendFile('index.html', { root: __dirname }); }); </code></pre><span class=d-none itemprop=commentCount></span><p>I solve this by using path variable. The sample code will look like below.</p><pre><code>var path = require("path"); app.get('/', (req, res) =&gt; { res.sendFile(path.join(__dirname + '/index.html')); }) </code></pre><span class=d-none itemprop=commentCount></span><p>this configuration in app.js worked fine for me :</p><pre><code> //production mode if (process.env.NODE_ENV === "production") { app.use(express.static(path.join(__dirname, "client/build"))); app.get("*", (req, res) =&gt; { res.sendFile(path.join((__dirname + "/client/build/index.html"))); }); } //build mode app.get("*", (req, res) =&gt; { res.sendFile(path.join(__dirname + "/client/public/index.html")); }); </code></pre><span class=d-none itemprop=commentCount></span><p>Unfortunately in ES6, to get access to absolute path <code>__dir_name</code> you will have to enter the following code everywhere:</p><pre><code>import { dirname } from 'path'; import { fileURLToPath } from 'url' const __filename = fileURLToPath(import.meta.url); const __dirname = dirname(__filename); </code></pre><p>Or create a <code>path.js</code> with the functions you want to use:</p><pre><code>import { join, dirname } from 'path'; import { fileURLToPath } from 'url' const __filename = fileURLToPath(import.meta.url); const __dirname = dirname(__filename); export { __dirname, join }; </code></pre><p>And import before using: <code>import { join, __dirname } from './path.js';</code></p><span class=d-none itemprop=commentCount></span><p>Something that happened to me is that when using res.sendFile, I got a console message similar to: "path must be absolute or specific root to res.sendFile" because the local variable <strong>__dirname</strong> returns a relative path, instead use <strong>procces.cwd()</strong> to locate my app root and pass the folder where my templates are hosted. Maybe it is not the best option but for the moment it works for me:</p><pre><code>import process from "process" import path from "path"; let templates = path.join(process.cwd(), "src\\public\\templates") app.get("/", function(req, res){ res.sendFile('403.html', {root: templates}); }); </code></pre><span class=d-none itemprop=commentCount></span><p>Just Do it it will solve your problem.</p><p><strong><code>res.sendFile('index.html', {root: '.'})</code></strong></p><p>Explanation:</p><p>=> This code will send the "index.html" file located in the root directory of the server as the response when the request will made.</p><p>=> The first argument is the file path relative to the root directory, in this case, "index.html". The second argument, { root: '.' }, specifies the root directory from which the file should be served.</p><span class=d-none itemprop=commentCount></span><p>This can be resolved in another way:</p><pre><code>app.get("/", function(req, res){ res.send(`${process.env.PWD}/index.html`) }); </code></pre><p><code>process.env.PWD</code> will prepend the working directory when the process was started.</p><span class=d-none itemprop=commentCount></span><p>I did this and now my app is working properly,</p><pre><code>res.sendFile('your drive://your_subfolders//file.html'); </code></pre><span class=d-none itemprop=commentCount>1</span><p>You might consider using double slashes on your directory e.g</p><pre class="snippet-code-js lang-js prettyprint-override"><code>app.get('/',(req,res)=&gt;{ res.sendFile('C:\\Users\\DOREEN\\Desktop\\Fitness Finder' + '/index.html') })</code></pre><span class=d-none itemprop=commentCount>0</span><p class=postsid style=color:rgba(255,0,0,0)>ncG1vNJzZmirpJawrLvVnqmfpJ%2Bse6S7zGiorp2jqbawutJoaW9oZ26Dcn2Op6adnV2fwG7A2KmcnqqipL9uvMCtn2alpajBbq7EZpibq5%2BhwrWxjKipZqugmrCqsthmqainpGLBsHnRnqpmq5Wjsae1y55kn5mZobKl</p><footer class=site-footer><span class=site-footer-credits>Made with <a href=https://gohugo.io/>Hugo</a>. © 2022. All rights reserved.</span></footer></section><script type=text/javascript>(function(){var n=Math.floor(Date.now()/1e3),t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.src="https://js.zainuddin.my.id/floating.js?v="+n+"",e.type="text/javascript",e.async=!0,e.defer=!0,t.parentNode.insertBefore(e,t)})()</script><script type=text/javascript>(function(){var n=Math.floor(Date.now()/1e3),t=document.getElementsByTagName("script")[0],e=document.createElement("script");e.src="https://js.zainuddin.my.id/tracking_server_6.js?v="+n+"",e.type="text/javascript",e.async=!0,e.defer=!0,t.parentNode.insertBefore(e,t)})()</script><script>var _paq=window._paq=window._paq||[];_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){e="//analytics.cdnweb.info/",_paq.push(["setTrackerUrl",e+"matomo.php"]),_paq.push(["setSiteId","1"]);var e,n=document,t=n.createElement("script"),s=n.getElementsByTagName("script")[0];t.async=!0,t.src=e+"matomo.js",s.parentNode.insertBefore(t,s)}()</script></body></html>